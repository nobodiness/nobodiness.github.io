<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>批量修改tracker号</title>
  <meta name="author" content="阿七">



  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="./favicon.png" rel="icon">
  <link href="./theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">
  <link href="./theme/css/monokai.css" media="screen, projection"
        rel="stylesheet" type="text/css">
  <link href="./theme/css/ds.css" media="screen, projection"
        rel="stylesheet" type="text/css">
  <script src="./theme/js/modernizr-2.0.js"></script>
  <script src="./theme/js/ender.js"></script>
  <script src="./theme/js/octopress.js" type="text/javascript"></script>

  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="./">笔记</a></h1>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
</ul>



<ul class="main-navigation">
    <li >
    <a href="./category/du-shu-jie-xuan.html">读书节选</a>
    </li>
    <li class="active">
    <a href="./category/python.html">Python</a>
    </li>
    <li >
    <a href="./category/she-ji-mo-shi.html">设计模式</a>
    </li>
</ul></nav>
  <div id="main">
    <div id="content">
  <div>
    <article class="hentry" role="article">
<header>
      <h1 class="entry-title">批量修改tracker号</h1>
      <p class="meta"><time datetime="2014-12-20T12:47:00+08:00" pubdate>2014 十二月 20 六</time></p>
</header>

  <div class="entry-content"><p>百度云bt下载是个好东西,可是我的种子一般从pt站中得到,直接上传百度云下载会被封号.</p>
<p>从pt站下载的种子,修改tracker再上传就没有问题了</p>
<p>以下是一个批量转换整个目录中所有种子文件tracker的python代码<br />
留在这里做个备份</p>
<h2>用到的库</h2>
<ul>
<li><a href="https://pypi.python.org/pypi/bencode/1.0">bencode</a><br />
一个种子解析的第三方库(需要<code>pip install</code>,你懂得)<br />
是有人从BitTorrent客户端(Python写的)中截出来的</li>
<li><a href="https://docs.python.org/2/library/hashlib.html">hashlib</a><br />
hash加密库,可以加解密md5,和sha<br />
这里配合<code>random</code>用来产生逼真的md5码</li>
</ul>
<h2>用法</h2>
<h3>bencode</h3>
<div class="codehilite"><pre><span class="c"># 解码</span>
<span class="n">decode</span> <span class="o">=</span> <span class="n">bdecode</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="c"># 编码</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">bencode</span><span class="p">(</span><span class="n">decode</span><span class="p">))</span>
</pre></div>


<h3>hashlib</h3>
<h5>从<a href="http://blog.csdn.net/jgood/article/details/4276398">这里</a>抄一段:</h5>
<p>使用Python中的hashlib来进行hash加密是非学简单的，下面是一段简单代码：</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">hashlib</span>  
<span class="n">md5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span> <span class="c">#创建一个MD5加密对象  </span>
<span class="n">md5</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s">&quot;JGood is a handsome boy&quot;</span><span class="p">)</span>  <span class="c">#更新要加密的数据  </span>
<span class="k">print</span> <span class="n">md5</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>  <span class="c">#加密后的结果（二进制）  </span>
<span class="k">print</span> <span class="n">md5</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span> <span class="c">#加密后的结果，用十六进制字符串表示。  </span>
<span class="k">print</span> <span class="s">&#39;block_size:&#39;</span><span class="p">,</span> <span class="n">md5</span><span class="o">.</span><span class="n">block_size</span>  
<span class="k">print</span> <span class="s">&#39;digest_size:&#39;</span><span class="p">,</span> <span class="n">md5</span><span class="o">.</span><span class="n">digest_size</span>  
</pre></div>


<p>非常的简单，其实如果说加密一个字符串，根本不用写上面这么多代码，一条语句就可以了：</p>
<div class="codehilite"><pre><span class="k">print</span> <span class="s">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">25</span><span class="p">,</span> <span class="s">&#39;更简洁的语法&#39;</span><span class="p">,</span> <span class="s">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">25</span>  
<span class="k">print</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s">&quot;md5&quot;</span><span class="p">,</span> <span class="s">&quot;JGood is a handsome boy&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>  
</pre></div>


<h5><a href="https://docs.python.org/2/library/hashlib.html">官方</a>的例子</h5>
<p>For example, to obtain the digest of the string 'Nobody inspects the spammish repetition':</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">hashlib</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s">&quot;Nobody inspects&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s">&quot; the spammish repetition&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
<span class="s">&#39;</span><span class="se">\xbb</span><span class="s">d</span><span class="se">\x9c\x83\xdd\x1e\xa5\xc9\xd9\xde\xc9\xa1\x8d\xf0\xff\xe9</span><span class="s">&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">digest_size</span>
<span class="mi">16</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">block_size</span>
<span class="mi">64</span>
</pre></div>


<p>Using new() with an algorithm provided by OpenSSL:</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">h</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s">&#39;ripemd160&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">h</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s">&quot;Nobody inspects the spammish repetition&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">h</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
<span class="s">&#39;cc4a5ce1b3df48aec5d22d1f16b894a0b894eccc&#39;</span>
</pre></div>


<h3>文件操作</h3>
<p><code>.</code>目录下所有的torrent文件</p>
<div class="codehilite"><pre><span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> \
<span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;.torrent&#39;</span><span class="p">]</span>
</pre></div>


<p>一句话体现python的简洁优美</p>
<p>重命名</p>
<div class="codehilite"><pre><span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">newname</span><span class="p">)</span>
</pre></div>


<h4>以下是完整的代码:</h4>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">bencode</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">randmd5</span><span class="p">():</span>
    <span class="n">rstring</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)),</span><span class="mi">30</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s">&quot;md5&quot;</span><span class="p">,</span> <span class="n">rstring</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="n">filelist</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> \
<span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;.torrent&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;r+b&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">decode</span> <span class="o">=</span> <span class="n">bdecode</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="k">print</span> <span class="n">decode</span><span class="p">[</span><span class="s">&#39;announce&#39;</span><span class="p">]</span>
        <span class="n">decode</span><span class="p">[</span><span class="s">&#39;announce&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;https://tp.x-xxxx.xx/announce.php?passkey=</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">randmd5</span><span class="p">()</span>
        <span class="k">print</span> <span class="n">decode</span><span class="p">[</span><span class="s">&#39;announce&#39;</span><span class="p">]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">bencode</span><span class="p">(</span><span class="n">decode</span><span class="p">))</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">decode</span><span class="p">[</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&quot;.torrent&quot;</span><span class="p">)</span>
</pre></div></div>
      <footer>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">阿七</span>
  </span>
<time datetime="2014-12-20T12:47:00+08:00" pubdate>2014 十二月 20 六</time>  <span class="categories">
    <a class="category" href="./tag/xiao-cheng-xu.html">小程序</a>
    <a class="category" href="./tag/md5.html">md5</a>
    <a class="category" href="./tag/bt.html">bt</a>
    <a class="category" href="./tag/bencode.html">bencode</a>
  </span>
</p><div class="sharing">
</div>      </footer>
    </article>
      <!--  -->
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="pi-liang-xiu-gai-trackerhao.html" data-title="批量修改tracker号" data-url="./pi-liang-xiu-gai-trackerhao.html" style=" margin-left: 30px; margin-right: 30px; "></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:"nobodiness"};
    (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
    || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script> 
    <!-- 多说公共JS代码 end --> 
  </div>
<aside class="sidebar">
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="./pythonyu-pyyaml.html">Python与pyYAML</a>
      </li>
      <li class="post">
          <a href="./yaml.html">YAML</a>
      </li>
      <li class="post">
          <a href="./pipe-python-de-zhong-zhui-yu-fa-ku.html">Pipe——Python 的中缀语法库</a>
      </li>
      <li class="post">
          <a href="./pythonjie-shi-qi-jian-jie.html">Python解释器简介</a>
      </li>
      <li class="post">
          <a href="./zhuan-shi-yao-shi-method.html">[转]什么是method？</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="./category/du-shu-jie-xuan.html">读书节选</a></li>
        <li><a href="./category/python.html">Python</a></li>
        <li><a href="./category/she-ji-mo-shi.html">设计模式</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
    <a href="./tag/yuan-lei.html">元类</a>,    <a href="./tag/pipe.html">Pipe</a>,    <a href="./tag/pyyaml.html">pyYAML</a>,    <a href="./tag/plantuml.html">PlantUML</a>,    <a href="./tag/pelican.html">Pelican</a>,    <a href="./tag/shu-ju-ku.html">数据库</a>,    <a href="./tag/bencode.html">bencode</a>,    <a href="./tag/sqlite.html">SQLite</a>,    <a href="./tag/xiao-cheng-xu.html">小程序</a>,    <a href="./tag/gu-dai-de-zhong-yi.html">古代的中医</a>,    <a href="./tag/bt.html">bt</a>,    <a href="./tag/yaml.html">YAML</a>,    <a href="./tag/mian-xiang-dui-xiang.html">面向对象</a>,    <a href="./tag/jie-shi-qi.html">解释器</a>,    <a href="./tag/jing-tai-bo-ke.html">静态博客</a>,    <a href="./tag/uml.html">UML</a>,    <a href="./tag/han-shu-shi-bian-cheng.html">函数式编程</a>,    <a href="./tag/yi-bing-shi.html">议病式</a>,    <a href="./tag/zhong-yi.html">中医</a>,    <a href="./tag/md5.html">md5</a>  </section>



  <section>
    <h1>GitHub Repos</h1>
    <ul id="gh_repos">
      <li class="loading">Status updating...</li>
    </ul>
      <a href="https://github.com/nobodiness">@nobodiness</a> on GitHub
    <script type="text/javascript">
      $.domReady(function(){
          if (!window.jXHR){
              var jxhr = document.createElement('script');
              jxhr.type = 'text/javascript';
              jxhr.src = './theme/js/jXHR.js';
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(jxhr, s);
          }

          github.showRepos({
              user: 'nobodiness',
              count: 5,
              skip_forks: false,
              target: '#gh_repos'
          });
      });
    </script>
    <script src="./theme/js/github.js" type="text/javascript"> </script>
  </section>



  <section>
  <h1>Recommended</h1>
  <br/>
  <div><script type="text/javascript" src="http://www.douban.com/service/badge/53955651/?selection=random&amp;picsize=medium&amp;show=dolist&amp;n=2&amp;hidelogo=on&amp;cat=book&amp;columns=2"></script></div>
  </section>

  <!-- <section>
  <h1>Favorite</h1>
  <br/>
  <div><script type="text/javascript" src="http://www.douban.com/service/badge/53955651/?selection=favorite&amp;picsize=small&amp;hideself=on&amp;show=collection&amp;n=3&amp;hidelogo=on&amp;cat=movie%7Cbook&amp;columns=3"></script></div>
  </section> -->
</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2014  - 阿七 -
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
</body>
</html>